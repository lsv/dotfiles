---
- name: Is composer installed?
  stat:
    path: "{{ folders.homedir }}/{{ username }}/{{ folders.programs }}/composer.phar"
  register: stat_composer

- name: Download composer
  when: not stat_composer.stat.exists
  block:
      - name: download
        shell: |
          wget -O "{{ folders.homedir }}/{{ username }}/{{ folders.programs }}/composer-setup.php" https://getcomposer.org/installer
          php "{{ folders.homedir }}/{{ username }}/{{ folders.programs }}/composer-setup.php --install-dir=/home/{{ username }}/{{ folders.programs }}"
          rm "{{ folders.homedir }}/{{ username }}/{{ folders.programs }}/composer-setup.php"

      - name: symlink composer.phar
        become: yes
        file:
          src: "{{ folders.homedir }}/{{ username }}/{{ folders.programs }}/composer.phar"
          dest: /usr/local/bin/composer.phar
          state: link
          force: true

      - name: symlink composer
        become: yes
        file:
          src: /usr/local/bin/composer.phar
          dest: /usr/local/bin/composer
          state: link
          force: true

      - name: symlink c
        become: yes
        file:
          src: /usr/local/bin/composer.phar
          dest: /usr/local/bin/c
          state: link
          force: true
